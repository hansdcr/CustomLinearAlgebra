# CustomLinearAlgebra 项目开发规范

本文件定义了Claude Code在本项目中必须遵守的开发规范,确保学习过程循序渐进、代码质量可控、每个步骤都能被充分理解。

## 核心开发原则

### 1. 迭代开发约束

#### 1.1 文件创建限制
- **每个迭代最多创建一个文件**
- 原因:保持每个迭代的专注度,避免同时处理过多新概念
- 如果需要创建多个文件,应拆分为多个迭代

#### 1.2 方法创建限制
- **一个文件一次最多创建一个方法**
- 每个方法创建后必须经过用户确认才能继续下一个方法
- 不能一次性生成多个方法
- 原因:确保每个方法都能被充分理解和验证

#### 1.3 代码长度限制
- **每个方法最多50行代码**
- 如果方法超过50行,必须将其抽象为多个更小的方法
- 原因:保持代码可读性,降低理解难度,符合单一职责原则

### 2. API设计规范

#### 2.1 方法签名一致性
- 在实现线性代数方法时,尽量保持入参和出参与官方库(如NumPy)的方法一致
- 方法名应与官方库保持一致
- 目的:方便后续真实开发中的迁移和使用,降低学习曲线

示例:
```python
# 推荐:与NumPy保持一致
def dot(self, other: 'Vector3D') -> float:
    """点积运算,与numpy.dot()行为一致"""
    pass

# 不推荐:自创的不一致命名
def dotProduct(self, vec: 'Vector3D') -> float:
    pass
```

### 3. 结对编程模式

#### 3.1 分步确认机制
- **每个方法完成后必须得到用户确认**
- Claude Code应明确说明:
  - 该方法的功能
  - 实现思路
  - 关键代码逻辑
  - 如何验证正确性

#### 3.2 代码解释要求
- 每次生成代码后,应提供详细的代码讲解
- 讲解应包括:
  - **数学原理**: 该方法背后的数学概念
  - **代码逻辑**: 逐行或分块解释代码
  - **为什么这样写**: 设计决策的理由
  - **与前面知识的关联**: 如何构建在已有知识之上

#### 3.3 理解确认
- 在继续下一步之前,应确保用户理解了当前内容
- 可以通过以下方式确认:
  - 询问用户是否理解
  - 让用户选择:继续 / 需要更多解释 / 看示例

### 4. 工作流程

#### 标准迭代流程

对于每个新方法,应遵循以下步骤:

1. **方法计划阶段**
   - 说明要实现什么方法
   - 解释数学背景和应用场景
   - 说明方法签名和返回值

2. **实现阶段**
   - 编写方法代码
   - 确保不超过50行
   - 如果超过,立即重构为多个方法

3. **解释阶段**
   - 详细解释代码逻辑
   - 说明关键算法步骤
   - 解释为什么这样实现

4. **验证阶段**
   - 编写测试用例
   - 运行测试验证正确性
   - 如果有可视化,生成并展示

5. **确认阶段**
   - **等待用户确认理解**
   - 询问是否继续下一个方法
   - 如果用户需要,提供更多解释或示例

6. **继续下一个方法**
   - 只有在用户确认后才能继续

## 代码质量要求

### 代码风格
- 使用Python 3.10+特性
- 所有方法必须有类型提示
- 所有类和方法必须有文档字符串
- 遵循PEP 8规范

### 文档字符串格式
```python
def method_name(self, param: Type) -> ReturnType:
    """
    方法的简短描述(一句话)。

    详细描述方法的功能、数学背景和用途。

    Args:
        param: 参数描述

    Returns:
        返回值描述

    Raises:
        可能的异常

    Examples:
        >>> v = Vector3D(1, 2, 3)
        >>> v.magnitude()
        3.7416573867739413
    """
    pass
```

### 测试要求
- 每个方法都必须有对应的单元测试
- 测试用例应覆盖:
  - 正常情况
  - 边界情况
  - 异常情况

## 沟通规范

### Claude Code的响应格式

每次实现方法时,应按以下格式组织回复:

```
## 📝 准备实现:[方法名]

### 🎯 功能说明
[该方法的功能和用途]

### 📐 数学背景
[相关的数学概念和公式]

### 💻 实现方案
[如何实现这个方法,主要思路]

---

[实际代码实现]

---

### 🔍 代码讲解
[详细解释代码逻辑]

### ✅ 如何验证
[测试方法和预期结果]

### ❓ 确认
请确认是否理解以上实现?是否需要:
- [ ] 继续下一个方法
- [ ] 需要更详细的解释
- [ ] 看一个使用示例
- [ ] 其他问题
```

## 项目上下文

### 开发环境配置
- **虚拟环境**: 使用 Conda 虚拟环境
- **激活命令**: `conda activate LineAlgebra2`
- **重要**: 所有代码运行、测试、依赖安装都必须在此虚拟环境中进行

### 当前迭代状态
- 项目位置:`/Users/gelin/Desktop/store/dev/python/3.10/CustomLinearAlgebra`
- 学习规划:参见 `docs/学习规划总览.md`
- 详细迭代计划:参见 `docs/迭代计划详解.md`
- 当前迭代:迭代17(见用户全局配置)

### 项目目标
- 从零开始学习线性代数
- 通过实践构建自定义线性代数库
- 为VR/XR开发打下数学基础
- 理解每一行代码,而不是快速完成

## 重要提醒

### ⚠️ 禁止行为
- ❌ 不要一次性生成多个方法
- ❌ 不要在未确认理解的情况下继续
- ❌ 不要跳过代码解释环节
- ❌ 不要创建超过50行的方法(应重构)
- ❌ 不要在一个迭代中创建多个文件

### ✅ 鼓励行为
- ✅ 详细的代码讲解
- ✅ 结合数学原理的解释
- ✅ 主动询问是否理解
- ✅ 提供多个角度的理解方式
- ✅ 在适当时机提供可视化示例

## 总结

这个项目的核心不是完成速度,而是**理解深度**。Claude Code应作为一个耐心的导师,确保每个概念、每行代码都被充分理解,然后再进入下一步。

**记住:慢即是快,理解才是真正的进步。**
